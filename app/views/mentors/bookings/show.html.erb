<div class="row">
  <div class="col-lg-8">
    <div class="card">
      <div class="card-header">
        <h2 class="mb-0">Detalles de la Reserva</h2>
      </div>
      <div class="card-body">
        <div class="row">
          <div class="col-md-6 mb-3">
            <h6 class="text-muted">Estudiante</h6>
            <p>
              <%= link_to mentors_student_path(@student) do %>
                <strong><%= @student.first_name %> <%= @student.last_name %></strong>
              <% end %>
            </p>
          </div>
          <div class="col-md-6 mb-3">
            <h6 class="text-muted">Estado</h6>
            <%= simple_form_for(@booking, url: mentors_booking_path(@booking), method: :patch, html: { data: { controller: "bookings", bookings_target: "form" } }) do |f| %>
              <%= f.input :status,
                    collection: Booking.statuses.keys,
                    selected: @booking.status,
                    label: false,
                    input_html: { 
                      class: 'form-select', 
                      data: { 
                        bookings_target: "status",
                        action: "change->bookings#toggleSubmit",
                        current_status: @booking.status 
                      } 
                    } %>
              <%= f.submit "Actualizar Estado", 
                    class: "btn btn btn-primary mt-2", 
                    data: { bookings_target: "updateButton" },
                    disabled: true %>
            <% end %>
          </div>
          <div class="col-md-6 mb-3">
            <h6 class="text-muted">Fecha y Hora</h6>
            <p>
              <%= @booking.starts_at.strftime("%d de %B, %Y") %><br>
              <strong><%= @booking.starts_at.strftime("%H:%M") %> - 
                <%= @booking.ends_at.strftime("%H:%M") %></strong>
            </p>
          </div>
          <div class="col-md-6 mb-3">
            <h6 class="text-muted">Precio</h6>
            <p class="h4 text-success">
              $<%= number_with_precision(@booking.price, precision: 2) %>
            </p>
          </div>
          <% if @booking.availability.category %>
            <div class="col-md-6 mb-3">
              <h6 class="text-muted">Categoría</h6>
              <p>
                <span class="badge fs-6" style="background-color: <%= @booking.availability.category.color %>;">
                  <%= @booking.availability.category.name %>
                </span>
              </p>
            </div>
          <% end %>
          <% if @booking.preference_id.present? %>
            <div class="col-md-6 mb-3">
              <h6 class="text-muted">ID de Pago</h6>
              <p><code><%= @booking.preference_id %></code></p>
            </div>
          <% end %>
          <div class="col-12 mb-3">
            <h6 class="text-muted">Información de Contacto del Estudiante</h6>
            <p>
              <strong>Email:</strong> <%= @student.email %><br>
              <strong>Teléfono:</strong> <%= @student.phone %>
            </p>
          </div>
        </div>
        <div class="d-flex gap-2 mt-4">
          <%= render "shared/components/go_back_button" %>
          <%= link_to "Ver estudiante", mentors_student_path(@student), class: "btn btn-info" %>
          <%= link_to "Acerca de este horario", mentors_availability_path(@booking.availability), class: "btn btn-primary" %>
        </div>
      </div>
    </div>
  </div>
  <div class="col-lg-4">
    <div class="card">
      <div class="card-header">
        <h5 class="mb-0">Información</h5>
      </div>
      <div class="card-body">
        <p class="small text-muted">
          Clase agendada el <%= @booking.created_at.strftime("%d/%m/%Y a las %H:%M") %>
        </p>
        <% if @booking.updated_at != @booking.created_at %>
          <p class="small text-muted">
            Última actualización: <%= @booking.updated_at.strftime("%d/%m/%Y %H:%M") %>
          </p>
        <% end %>
      </div>
    </div>
    <div class="card mt-3">
      <div class="card-header">
        <h5 class="mb-0">Estudiante</h5>
      </div>
      <div class="card-body">
        <p>
          <strong><%= @student.first_name %> <%= @student.last_name %></strong><br>
          <small class="text-muted"><%= @student.email %></small>
        </p>
        <%= link_to "Ver Perfil Completo", mentors_student_path(@student), class: "btn btn-primary w-100" %>
      </div>
    </div>
  </div>
</div>
